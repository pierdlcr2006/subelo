---
// Componente Header mejorado y compacto
---

<header class="main-header" id="mainHeader">
    <div class="header-content">
        <div class="logo-section">
            <div class="logo-icon">
                <i class="bi bi-mouse"></i>
            </div>
            <div class="logo-text">
                <h1>ERGOWAVE</h1>
                <span>Mouse Tecnológico</span>
            </div>
        </div>
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menú">
            <i class="bi bi-list"></i>
        </button>
        <nav class="main-nav" id="mainNav">
            <a href="/" class="nav-link">
                <i class="bi bi-house-fill"></i>
                <span>Inicio</span>
            </a>
            
            <!-- Semana 02 -->
            <div class="week-dropdown">
                <a href="/semanas/semana02" class="nav-link week-link">
                    <span>Semana 02</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 02</div>
                    <a href="/semanas/semana02#retos" class="submenu-link">
                        <i class="bi bi-flag-fill"></i>
                        <span>Retos Propuestos</span>
                    </a>
                    <a href="/semanas/semana02#modelo" class="submenu-link">
                        <i class="bi bi-puzzle-fill"></i>
                        <span>Modelo Canvas</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 04 -->
            <div class="week-dropdown">
                <a href="/semanas/semana04" class="nav-link week-link">
                    <span>Semana 04</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 04</div>
                    <a href="/semanas/semana04#teoria" class="submenu-link">
                        <i class="bi bi-book-fill"></i>
                        <span>Teoría Impresión 3D</span>
                    </a>
                    <a href="/semanas/semana04#diseno" class="submenu-link">
                        <i class="bi bi-pencil-fill"></i>
                        <span>Proceso de Diseño</span>
                    </a>
                    <a href="/semanas/semana04#resultados" class="submenu-link">
                        <i class="bi bi-trophy-fill"></i>
                        <span>Resultados</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 06 -->
            <div class="week-dropdown">
                <a href="/semanas/semana06" class="nav-link week-link">
                    <span>Semana 06</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 06</div>
                    <a href="/semanas/semana06#teoria" class="submenu-link">
                        <i class="bi bi-lightbulb-fill"></i>
                        <span>Cortador Láser</span>
                    </a>
                    <a href="/semanas/semana06#modelado" class="submenu-link">
                        <i class="bi bi-grid-3x3-fill"></i>
                        <span>Modelado CAD</span>
                    </a>
                    <a href="/semanas/semana06#fabricacion" class="submenu-link">
                        <i class="bi bi-gear-fill"></i>
                        <span>Fabricación</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 08 -->
            <div class="week-dropdown">
                <a href="/semanas/semana08" class="nav-link week-link">
                    <span>Semana 08</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 08</div>
                    <a href="/semanas/semana08#ensamblaje" class="submenu-link">
                        <i class="bi bi-layers-fill"></i>
                        <span>Ensamblaje</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 10 -->
            <div class="week-dropdown">
                <a href="/semanas/semana10" class="nav-link week-link">
                    <span>Semana 10</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 10</div>
                    <a href="/semanas/semana10#electronica" class="submenu-link">
                        <i class="bi bi-cpu-fill"></i>
                        <span>Electrónica</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 12 -->
            <div class="week-dropdown">
                <a href="/semanas/semana12" class="nav-link week-link">
                    <span>Semana 12</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 12</div>
                    <a href="/semanas/semana12#programacion" class="submenu-link">
                        <i class="bi bi-code-square"></i>
                        <span>Programación</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 14 -->
            <div class="week-dropdown">
                <a href="/semanas/semana14" class="nav-link week-link">
                    <span>Semana 14</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 14</div>
                    <a href="/semanas/semana14#testing" class="submenu-link">
                        <i class="bi bi-check2-circle"></i>
                        <span>Testing</span>
                    </a>
                </div>
            </div>
            
            <!-- Semana 16 -->
            <div class="week-dropdown">
                <a href="/semanas/semana16" class="nav-link week-link">
                    <span>Semana 16</span>
                </a>
                <div class="week-submenu">
                    <div class="submenu-header">Semana 16</div>
                    <a href="/semanas/semana16#presentacion" class="submenu-link">
                        <i class="bi bi-display-fill"></i>
                        <span>Presentación Final</span>
                    </a>
                </div>
            </div>
            
            <a href="/innovacion" class="nav-link nav-link-special">
                <i class="bi bi-rocket-takeoff-fill"></i>
                <span>Innovación</span>
            </a>
        </nav>
        <div class="header-actions">
            <button class="theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                <i class="bi bi-moon-stars-fill"></i>
            </button>
        </div>
    </div>
</header>

<style>
/* Header optimized with fixed positioning and intelligent scroll behavior */
.main-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
    transform: translateY(0);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
    will-change: transform;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

.main-header.header-hidden {
    transform: translateY(-100%);
}

.main-header.header-visible {
    transform: translateY(0);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

/* Prevent layout shift by adding placeholder */
.header-placeholder {
    height: 70px;
    width: 100%;
}

/* Week dropdown styles - Horizontal mega menu */
.week-dropdown {
    position: relative;
    display: flex;
    align-items: center;
}

.week-link {
    font-size: 0.95rem;
    padding: 0.6rem 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    min-height: 44px;
    position: relative;
}

/* Active state for current week */
.week-link.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
    color: var(--accent-primary);
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
}

.week-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
    border-radius: 3px 3px 0 0;
}

/* Active state for Inicio */
.nav-link.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
    color: var(--accent-primary);
    font-weight: 700;
}

/* Ensure Innovación button only highlights when active */
.nav-link-special {
    background: transparent;
    border: 1px solid transparent;
}

.nav-link-special.active {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
    border-color: var(--accent-primary);
    font-weight: 700;
}

.week-submenu {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
    background: var(--bg-secondary);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.25);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1001;
    padding: 1rem;
    min-width: 260px;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

.week-dropdown:hover .week-submenu,
.week-submenu:hover {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(-50%) translateY(0);
}

/* Keep submenu open when hovering over it */
.week-submenu::before {
    content: '';
    position: absolute;
    top: -8px;
    left: 0;
    right: 0;
    height: 8px;
    background: transparent;
}

.submenu-header {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--accent-primary);
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    border-bottom: 2px solid var(--border);
    text-transform: uppercase;
    letter-spacing: 0.75px;
    text-align: center;
}

.submenu-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.85rem 1rem;
    background: var(--surface);
    border-radius: 10px;
    text-decoration: none;
    color: var(--text-primary);
    transition: all 0.25s ease;
    font-size: 0.9rem;
    margin-bottom: 0.4rem;
    border-left: 4px solid transparent;
    min-height: 48px;
}

.submenu-link:last-child {
    margin-bottom: 0;
}

.submenu-link:hover {
    background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
    border-left-color: var(--accent-primary);
    transform: translateX(5px);
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
}

.submenu-link i {
    font-size: 1.2rem;
    color: var(--accent-primary);
    width: 24px;
    text-align: center;
    flex-shrink: 0;
}

.submenu-link span {
    font-weight: 500;
    flex: 1;
    line-height: 1.4;
}

/* Mobile adjustments */
@media (max-width: 1400px) {
    .week-link {
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
    }
}

@media (max-width: 1200px) {
    .week-link span {
        display: none;
    }
    
    .week-link {
        padding: 0.6rem;
        min-width: 48px;
        justify-content: center;
    }
    
    .week-link i {
        margin: 0;
        font-size: 1.1rem;
    }
}

@media (max-width: 768px) {
    .week-dropdown {
        width: 100%;
    }
    
    .week-link {
        width: 100%;
        justify-content: flex-start;
    }
    
    .week-submenu {
        position: static;
        transform: none;
        opacity: 1;
        visibility: visible;
        box-shadow: none;
        border: none;
        background: transparent;
        padding: 0 0 0 1.5rem;
        display: none;
        margin-top: 0.5rem;
    }
    
    .week-dropdown:hover .week-submenu,
    .week-dropdown.active .week-submenu {
        display: block;
    }
    
    .submenu-header {
        display: none;
    }
    
    .submenu-link {
        font-size: 0.85rem;
        padding: 0.5rem;
    }
}
</style>

<script>
    // Optimized header scroll behavior with performance enhancements
    class SmartHeader {
        constructor() {
            this.header = document.getElementById('mainHeader');
            this.lastScrollTop = 0;
            this.scrollThreshold = 100;
            this.delta = 5; // Minimum scroll delta to trigger action
            this.didScroll = false;
            this.isMobile = window.innerWidth <= 768;
            
            this.init();
        }
        
        init() {
            // Use requestAnimationFrame for smooth scroll detection
            window.addEventListener('scroll', () => {
                this.didScroll = true;
            }, { passive: true });
            
            // Check scroll position every 250ms instead of on every scroll event
            setInterval(() => {
                if (this.didScroll) {
                    this.handleScroll();
                    this.didScroll = false;
                }
            }, 250);
            
            // Handle resize events for responsive behavior
            window.addEventListener('resize', this.debounce(() => {
                this.isMobile = window.innerWidth <= 768;
            }, 250));
            
            // Handle touch events for mobile
            let touchStartY = 0;
            let touchEndY = 0;
            
            document.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            document.addEventListener('touchmove', (e) => {
                touchEndY = e.touches[0].clientY;
                this.didScroll = true;
            }, { passive: true });
        }
        
        handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            // Don't hide header if scroll distance is too small
            if (Math.abs(this.lastScrollTop - scrollTop) <= this.delta) {
                return;
            }
            
            // Near top of page - always show header
            if (scrollTop < this.scrollThreshold) {
                this.showHeader();
                this.header.classList.remove('header-visible');
            }
            // Scrolling down - hide header
            else if (scrollTop > this.lastScrollTop && scrollTop > this.scrollThreshold) {
                this.hideHeader();
            }
            // Scrolling up - show header with enhanced shadow
            else if (scrollTop < this.lastScrollTop) {
                this.showHeader();
                this.header.classList.add('header-visible');
            }
            
            this.lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }
        
        hideHeader() {
            this.header.classList.add('header-hidden');
            this.header.classList.remove('header-visible');
            this.header.setAttribute('aria-hidden', 'true');
        }
        
        showHeader() {
            this.header.classList.remove('header-hidden');
            this.header.setAttribute('aria-hidden', 'false');
        }
        
        // Debounce utility for performance
        debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    }
    
    // Initialize smart header when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            new SmartHeader();
            setActivePage();
            initWeekDropdowns();
        });
    } else {
        new SmartHeader();
        setActivePage();
        initWeekDropdowns();
    }
    
    // Active page indicator
    function setActivePage() {
        const currentPath = window.location.pathname;
        
        // Remove active class from all links
        document.querySelectorAll('.nav-link, .week-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Set active for Inicio
        if (currentPath === '/' || currentPath === '/index.html') {
            const inicioLink = document.querySelector('a[href="/"]');
            if (inicioLink) inicioLink.classList.add('active');
            return;
        }
        
        // Set active for Innovación
        if (currentPath.includes('/innovacion')) {
            const innovacionLink = document.querySelector('.nav-link-special');
            if (innovacionLink) innovacionLink.classList.add('active');
            return;
        }
        
        // Set active for Semanas
        const weekMatch = currentPath.match(/\/semanas\/(semana\d+)/);
        if (weekMatch) {
            const weekNumber = weekMatch[1];
            const weekLink = document.querySelector(`a[href*="${weekNumber}"].week-link`);
            if (weekLink) {
                weekLink.classList.add('active');
            }
        }
    }
    
    // Week dropdowns functionality for mobile
    function initWeekDropdowns() {
        const weekDropdowns = document.querySelectorAll('.week-dropdown');
        const isMobile = () => window.innerWidth <= 768;
        
        weekDropdowns.forEach(dropdown => {
            const weekLink = dropdown.querySelector('.week-link');
            const submenu = dropdown.querySelector('.week-submenu');
            
            if (weekLink && submenu) {
                // Mobile: Toggle on click
                weekLink.addEventListener('click', (e) => {
                    if (isMobile()) {
                        e.preventDefault();
                        
                        // Close other dropdowns
                        weekDropdowns.forEach(other => {
                            if (other !== dropdown) {
                                other.classList.remove('active');
                            }
                        });
                        
                        // Toggle current dropdown
                        dropdown.classList.toggle('active');
                    }
                });
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (!isMobile()) {
                weekDropdowns.forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
            }
        });
    }
</script>
